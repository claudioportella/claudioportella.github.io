<!DOCTYPE html>
<html lang="pt-br" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificação de Problemas Técnicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0a;
            --card-dark: #141414;
            --inner-box: #1a1a1a;
            --border-subtle: #262626;
            --accent-blue: #3b82f6;
            --success-green: #10b981;
            --error-red: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #ededed;
            overflow-x: hidden;
        }

        .main-container {
            background: var(--card-dark);
            border: 1px solid var(--border-subtle);
            border-radius: 2.5rem;
        }

        .inner-group-box {
            background: var(--inner-box);
            border: 1px solid var(--border-subtle);
            border-radius: 1.5rem;
            padding: 1.5rem;
        }

        .item-row {
            padding: 1rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .item-row:first-child {
            padding-top: 0;
        }

        .item-row:last-child {
            padding-bottom: 0;
            border-bottom: none !important;
        }

        .status-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            border: 1px solid #2d2d2d;
            background: #1a1a1a;
            color: #4a4a4a;
            font-weight: 800;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .status-btn:hover {
            border-color: #444;
        }

        .status-btn.active-ok {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
            border-color: var(--success-green);
        }

        .status-btn.active-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-red);
            border-color: var(--error-red);
        }

        .generate-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .destiny-selector {
            display: flex;
            background: var(--inner-box);
            padding: 4px;
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
        }

        .destiny-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
            color: #666;
        }

        .destiny-option.active {
            background: #262626;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        #preview-modal-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .item-detail {
            display: block;
            font-size: 0.75rem;
            opacity: 0.5;
            margin-top: 2px;
            font-weight: 400;
        }

        @media print {
            body { background: white !important; color: black !important; }
            .no-print { display: none !important; }
            #preview-modal { position: relative !important; display: block !important; padding: 0 !important; background: white !important; }
        }
    </style>
</head>
<body class="min-h-screen">

    <script id="config-data" type="application/json">
    [
        {
            "categoria": "Verificação inicial",
            "itens": [
                {
                    "id": "logo_senador",
                    "critical": true,
                    "label": "Trabalho sem logomarca do senador",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Enviar e-mail Logomarca e Atividade Parlamentar",
                    "destiny": "ambos"
                }
            ]
        },
        {
            "categoria": "Verificação no SIGRAF",
            "itens": [
                {
                    "id": "sigraf_formato",
                    "critical": true,
                    "label": "Formato correto na Ordem de Serviço",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Pedir correção do formato para SEAUFAT",
                    "destiny": "impressao"
                },
                {
                    "id": "sigraf_cores",
                    "critical": true,
                    "label": "Cores corretas na Ordem de Serviço",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Pedir correção das cores para SEAUFAT",
                    "destiny": "impressao"
                },
                {
                    "id": "sigraf_paginas",
                    "critical": true,
                    "label": "Número de páginas correto na OS",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Pedir correção do número de páginas para SEAUFAT",
                    "destiny": "impressao"
                }
            ]
        },
        {
            "categoria": "Comprovação no Adobe Acrobat",
            "itens": [
                {
                    "id": "cmyk_check",
                    "critical": true,
                    "label": "Cores em CMYK",
                    "action": "relatório",
                    "problem": "Elementos em RGB",
                    "solution": "Converter para CMYK.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "pb_check",
                    "critical": true,
                    "label": "Trabalho PB sem outras cores",
                    "action": "relatório",
                    "problem": "Elementos coloridos",
                    "solution": "Converter para PB",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "tac_300",
                    "critical": true,
                    "label": "Carga de tintas abaixo de 300%",
                    "action": "relatório",
                    "problem": "Concentração de cores muito alta em fotos",
                    "solution": "Clarear, de forma que a concentração de cores nas áreas mais escuras não exceda 300%.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "resolution_check",
                    "critical": true,
                    "label": "Imagens em alta resolução",
                    "action": "relatório",
                    "problem": "Imagens em baixa resolução",
                    "solution": "Usar imagens em alta resolução (300ppi); ou autorizar a impressão com este problema técnico.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "pag_multiple_4",
                    "critical": true,
                    "label": "Páginas múltiplo de 4",
                    "action": "relatório",
                    "problem": "Total de páginas do miolo não é múltiplo de 4",
                    "solution": "Acrescentar ou retirar páginas.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "fonts_embed",
                    "critical": true,
                    "label": "Fontes incorporadas",
                    "action": "relatório",
                    "problem": "Fonte não incorporada",
                    "solution": "Na exportação do PDF, configurar o programa para que incorpore as fontes.",
                    "message": "—",
                    "destiny": "impressao"
                }
            ]
        },
        {
            "categoria": "Verificação manual",
            "itens": [
                {
                    "id": "sangria_5mm",
                    "critical": true,
                    "label": "Sangria de 5 mm em todas as bordas",
                    "action": "relatório",
                    "problem": "Sangria",
                    "solution": "Incluir sangria de 5 mm em todas as bordas",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "marcas_check",
                    "critical": true,
                    "label": "Sem marcas de corte, registro...",
                    "action": "relatório",
                    "problem": "Marcas",
                    "solution": "Retirar marcas de corte, escala de cores, espaçador",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "marcas_dobra",
                    "critical": true,
                    "label": "Marcas de dobra",
                    "action": "relatório",
                    "problem": "Marcas de dobra",
                    "solution": "Inserir marcas pontilhadas no local da dobra, na região externa da arte, mas dentro da área de sangria.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "margem_seguranca",
                    "critical": true,
                    "label": "Margem de segurança de 5 mm",
                    "action": "relatório",
                    "problem": "Elementos próximos à área de corte",
                    "solution": "Aplicar distância mínima de segurança de 5 mm. Para lombada colada, nas primeiras e últimas páginas e nas partes internas da capa a distância mínima deve ser de 10 mm.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "preto_k",
                    "critical": true,
                    "label": "Elementos pretos apenas no canal K<span class='item-detail'>— com texto vazado: 30c 0m 0y 100k</span><span class='item-detail'>— sem texto vazado: 40c 20m 20y 100k</span>",
                    "action": "relatório",
                    "problem": "Elemento preto nas 4 cores CMYK",
                    "solution": "Passar para somente Preto K 100%. Os outros canais de cor precisam estar em 0%.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "preto_chapado",
                    "critical": true,
                    "label": "Áreas com chapados pretos calçados?",
                    "action": "relatório",
                    "problem": "Preto chapado puro (0c 0m 0y 100k)",
                    "solution": "Calçar o preto: Com texto vazado (30c 0m 0y 100k); Sem texto vazado (40c 20m 20y 100k)",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "overprint_preto",
                    "critical": true,
                    "label": "Elementos pretos com overprint",
                    "action": "relatório",
                    "problem": "Cor de fundo vazada no local do preto",
                    "solution": "Deixar overprint. Ou seja, manter o fundo e o preto, um sobre o outro.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "pag_individuais",
                    "critical": true,
                    "label": "Miolo sem páginas agrupadas",
                    "action": "relatório",
                    "problem": "Páginas agrupadas",
                    "solution": "Finalizar arquivo com páginas individuais e em sequência.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "capa_montada",
                    "critical": true,
                    "label": "Capa aberta montada",
                    "action": "relatório",
                    "problem": "Capas e lombada em páginas diferentes",
                    "solution": "Preparar PDF com 1ª e 4ª capas, orelhas e lombada em uma página única (capa aberta). Inserir marcas de dobra pontilhadas para a lombadas e orelhas. Se houver conteúdo na 2ª e 3ª capas, prepará-las da mesma forma.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "medida_lombada",
                    "critical": true,
                    "label": "Medida da lombada",
                    "action": "relatório",
                    "problem": "Medida da lombada incompatível com a quantidade de páginas",
                    "solution": "Ajustar lombada para XX mm.",
                    "message": "Informar a medida correta da lombada.",
                    "destiny": "impressao"
                },
                {
                    "id": "lombada_marcada",
                    "critical": true,
                    "label": "Lombada marcada",
                    "action": "relatório",
                    "problem": "Lombada marcada",
                    "solution": "Ajustar o layout de forma que não haja elementos alinhados com as bordas da lombada e das orelhas.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "afastamento_lombada",
                    "critical": true,
                    "label": "Elementos afastados da lombada",
                    "action": "relatório",
                    "problem": "Elementos na capa/contracapa muito próximos da lombada",
                    "solution": "Deixar a distância de 10mm, para que não fiquem em cima do vinco.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "sentido_lombada",
                    "critical": true,
                    "label": "Sentido da lombada correto",
                    "action": "relatório",
                    "problem": "Conteúdo da lombada em sentido invertido",
                    "solution": "Girar 180 graus, de forma que a leitura do texto fique de cima para baixo; ou autorizar a impressão desta forma.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "tipo_encadernacao",
                    "critical": true,
                    "label": "Compatível com encadernação com cola",
                    "action": "relatório",
                    "problem": "Quantidade de páginas é pequena para acabamento com cola",
                    "solution": "Alterar capa para grampo (sem lombada)",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "colofao_check",
                    "critical": true,
                    "label": "Colofão correto",
                    "action": "relatório",
                    "problem": "Informações do colofão desatualizadas",
                    "solution": "Atualizar as informações.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "ficha_catalog",
                    "critical": true,
                    "label": "Ficha catalográfica atualizada",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Solicitar nova ficha catalográfica para COBIB",
                    "destiny": "impressao"
                },
                {
                    "id": "cedit_mesa",
                    "critical": true,
                    "label": "Livro da CEDIT com Mesa e colofão atuais",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Solicitar atualização do colofão para SEFPRO",
                    "destiny": "impressao"
                },
                {
                    "id": "cartao_visita",
                    "critical": true,
                    "label": "Cartão de visitas no padrão do Senado",
                    "action": "relatório",
                    "problem": "Cartão de visitas fora do padrão",
                    "solution": "Seguir o padrão do Manual de Identidade Visual do Senado Federal.",
                    "message": "—",
                    "destiny": "impressao"
                },
                {
                    "id": "chancela_correios",
                    "critical": true,
                    "label": "Envelope com a chancela dos Correios",
                    "action": "MSG",
                    "problem": "—",
                    "solution": "—",
                    "message": "Confirmar a chancela dos Correios com SEAUFAT",
                    "destiny": "impressao"
                }
            ]
        }
    ]
    </script>

    <main class="max-w-4xl mx-auto p-4 md:p-8 lg:p-12 no-print">
        <div class="main-container p-8 md:p-10 space-y-10">
            
            <div class="space-y-4">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] ml-2">Destino do Trabalho</h3>
                <div class="destiny-selector">
                    <div onclick="setDestiny('impressao')" id="opt-impressao" class="destiny-option active">Impressão</div>
                    <div onclick="setDestiny('plotagem')" id="opt-plotagem" class="destiny-option">Plotagem</div>
                </div>
            </div>

            <div id="checklist-container" class="space-y-10">
                <!-- Conteúdo gerado via JS -->
            </div>

            <div class="flex pt-4">
                <button id="btn-gerar" disabled onclick="abrirModalRelatorio()" title="Marque todos os itens para gerar o relatório" class="generate-btn mx-auto bg-white hover:bg-gray-200 text-black font-bold py-4 px-10 rounded-2xl transition duration-300 flex justify-center items-center gap-3 text-xs uppercase shadow-xl">
                    Gerar Relatório
                </button>
            </div>
        </div>
    </main>

    <div id="preview-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-[2.5rem] overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 bg-gray-50 border-b flex justify-between items-center no-print">
                <span class="text-[10px] font-black uppercase text-gray-400 ml-4">Relatório de problemas técnicos</span>
                <button onclick="fecharModal()" class="p-2 hover:bg-gray-200 rounded-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#000" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
                </button>
            </div>
            <div id="preview-modal-content" class="p-8 md:p-12 overflow-y-auto bg-white text-black leading-relaxed"></div>
            <div id="modal-actions" class="p-6 bg-gray-50 border-t flex justify-center no-print hidden">
                <button onclick="copiarTexto()" class="bg-black text-white font-bold py-4 px-10 rounded-2xl transition duration-300 flex justify-center items-center gap-3 text-xs uppercase shadow-xl hover:bg-gray-800">
                    Copiar relatório
                </button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-12 left-1/2 -translate-x-1/2 bg-emerald-500 text-black font-bold text-xs px-10 py-4 rounded-2xl opacity-0 transition-all duration-300 shadow-2xl pointer-events-none uppercase tracking-widest z-[60]">
        Relatório copiado! Pronto para colar no e-mail.
    </div>

    <script>
        let fullConfig = [];
        let activeDestiny = 'impressao';
        let state = {};
        let visibleItensCount = 0;

        function loadConfig() {
            try {
                const configElement = document.getElementById('config-data');
                fullConfig = JSON.parse(configElement.textContent);
                return true;
            } catch (error) {
                console.error("Erro ao carregar configuração:", error);
                return false;
            }
        }

        function setDestiny(dest) {
            activeDestiny = dest;
            document.getElementById('opt-impressao').classList.toggle('active', dest === 'impressao');
            document.getElementById('opt-plotagem').classList.toggle('active', dest === 'plotagem');
            renderChecklist();
            checkCompletion();
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = ''; 
            visibleItensCount = 0;

            fullConfig.forEach(cat => {
                const filteredItens = cat.itens.filter(item => 
                    item.destiny === 'ambos' || item.destiny === activeDestiny
                );

                if (filteredItens.length > 0) {
                    let html = `
                        <div class="space-y-4">
                            <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] ml-2">${cat.categoria}</h3>
                            <div class="inner-group-box">
                                <div class="grid grid-cols-1">
                    `;
                    
                    filteredItens.forEach((item, index) => {
                        visibleItensCount++;
                        if (state[item.id] === undefined) state[item.id] = null;
                        
                        const borderClass = index < filteredItens.length - 1 ? 'border-b border-white/5' : '';
                        const okActive = state[item.id] === 'ok' ? 'active-ok' : '';
                        const errActive = state[item.id] === 'error' ? 'active-error' : '';

                        html += `
                            <div class="item-row ${borderClass}">
                                <span class="text-sm font-medium text-gray-400 transition-colors leading-tight">${item.label}</span>
                                <div class="flex gap-2">
                                    <button onclick="setStatus('${item.id}', 'ok')" id="btn-ok-${item.id}" class="status-btn ${okActive}">✓</button>
                                    <button onclick="setStatus('${item.id}', 'error')" id="btn-err-${item.id}" class="status-btn ${errActive}">✕</button>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div></div></div>`;
                    container.innerHTML += html;
                }
            });
        }

        function setStatus(id, type) {
            const btnOk = document.getElementById(`btn-ok-${id}`);
            const btnErr = document.getElementById(`btn-err-${id}`);

            if (state[id] === type) {
                state[id] = null;
                btnOk.classList.remove('active-ok');
                btnErr.classList.remove('active-error');
            } else {
                state[id] = type;
                if (type === 'ok') {
                    btnOk.classList.add('active-ok');
                    btnErr.classList.remove('active-error');
                } else {
                    btnErr.classList.add('active-error');
                    btnOk.classList.remove('active-ok');
                }
            }
            checkCompletion();
        }

        function checkCompletion() {
            let preenchidosVisiveis = 0;
            fullConfig.forEach(cat => {
                cat.itens.forEach(item => {
                    if ((item.destiny === 'ambos' || item.destiny === activeDestiny) && state[item.id] !== null) {
                        preenchidosVisiveis++;
                    }
                });
            });
            const btn = document.getElementById('btn-gerar');
            const isFinished = preenchidosVisiveis >= visibleItensCount;
            btn.disabled = !isFinished;
            
            if (isFinished) {
                btn.removeAttribute('title');
            } else {
                btn.setAttribute('title', 'Marque todos os itens para gerar o relatório');
            }
        }

        function abrirModalRelatorio() {
            gerarRelatorio();
            document.getElementById('preview-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function fecharModal() {
            document.getElementById('preview-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function gerarRelatorio() {
            const preview = document.getElementById('preview-modal-content');
            const actions = document.getElementById('modal-actions');
            let errorRows = [];
            let messages = [];
            
            fullConfig.forEach(cat => {
                cat.itens.forEach(item => {
                    if ((item.destiny === 'ambos' || item.destiny === activeDestiny) && state[item.id] === 'error') {
                        if (item.action === "MSG" && item.message !== "—") {
                            messages.push(item.message);
                        } else {
                            const cleanProblem = item.problem.replace(/<[^>]*>/g, '');
                            errorRows.push({ prob: cleanProblem, sol: item.solution, critical: item.critical });
                        }
                    }
                });
            });

            let htmlContent = `<div id="report-table-container" style="font-family: 'Inter', sans-serif; color: #333;">`;
            
            if (messages.length > 0) {
                messages.forEach(msg => {
                    htmlContent += `<div style="padding: 15px; margin-bottom: 10px; background: #fff9f0; border: 1px solid #ffeed4; border-radius: 1.5rem; text-align: center; font-weight: 600; font-size: 13px; color: #854d0e;">➜ ${msg}</div>`;
                });
            }

            if (errorRows.length === 0 && messages.length === 0) {
                htmlContent += `<div style="padding: 15px; background: #f0fdf4; border: 1px solid #dcfce7; border-radius: 1.5rem; text-align: center; font-weight: 600; font-size: 13px; color: #166534;">✔ Nenhum problema técnico encontrado</div>`;
                actions.classList.add('hidden');
            } else if (errorRows.length > 0) {
                htmlContent += `<table id="report-table" style="width: 100%; border-collapse: collapse; font-size: 13px; border: 1px solid #edf2f7; margin-top: 8px;">`;
                htmlContent += `<thead style="background: #f7fafc;"><tr style="border-bottom: 2px solid #edf2f7;"><th colspan="2" style="padding: 10px; text-align: left; font-size: 10px; text-transform: uppercase;">Problema encontrado</th><th style="padding: 10px; text-align: left; font-size: 10px; text-transform: uppercase;">Como solucionar</th></tr></thead><tbody>`;
                errorRows.forEach(row => {
                    const icon = row.critical ? `❌` : `➜`;
                    htmlContent += `<tr><td style="padding: 10px; border: 1px solid #edf2f7; text-align: center;">${icon}</td><td style="padding: 10px; border: 1px solid #edf2f7; font-weight: 500;">${row.prob}</td><td style="padding: 10px; border: 1px solid #edf2f7; color: #4a5568;">${row.sol}</td></tr>`;
                });
                htmlContent += `</tbody></table>`;
                actions.classList.remove('hidden');
            } else {
                actions.classList.add('hidden');
            }
            htmlContent += `</div>`;
            preview.innerHTML = htmlContent;
        }

        async function copiarTexto() {
            const tableElement = document.getElementById('report-table');
            if (!tableElement) return;

            try {
                const blob = new Blob([tableElement.outerHTML], { type: 'text/html' });
                const data = [new ClipboardItem({ 
                    'text/html': blob, 
                    'text/plain': new Blob([tableElement.innerText], { type: 'text/plain' }) 
                })];
                await navigator.clipboard.write(data);
            } catch (err) {
                const range = document.createRange(); 
                range.selectNode(tableElement);
                window.getSelection().removeAllRanges(); 
                window.getSelection().addRange(range);
                document.execCommand('copy');
            }
            
            window.getSelection().removeAllRanges();

            const toast = document.getElementById('toast');
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 2500);
        }

        window.onload = () => { 
            if (loadConfig()) renderChecklist(); 
        };
    </script>
</body>
</html>
