<!DOCTYPE html>
<html lang="pt-br" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serviço de Controle da Pré-impressão</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0a;
            --card-dark: #141414;
            --inner-box: #1a1a1a;
            --border-subtle: #262626;
            --accent-blue: #3b82f6;
            --success-green: #10b981;
            --error-red: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #ededed;
            overflow-x: hidden;
        }

        .main-container {
            background: var(--card-dark);
            border: 1px solid var(--border-subtle);
            border-radius: 2.5rem;
        }

        .inner-group-box {
            background: var(--inner-box);
            border: 1px solid var(--border-subtle);
            border-radius: 1.5rem;
            padding: 1.5rem;
        }

        .item-row {
            padding: 1rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .item-row:first-child {
            padding-top: 0;
        }

        .item-row:last-child {
            padding-bottom: 0;
            border-bottom: none !important;
        }

        .status-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            border: 1px solid #2d2d2d;
            background: #1a1a1a;
            color: #4a4a4a;
            font-weight: 800;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .status-btn:hover {
            border-color: #444;
        }

        .status-btn.active-ok {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
            border-color: var(--success-green);
        }

        .status-btn.active-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-red);
            border-color: var(--error-red);
        }

        .generate-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        #preview-modal-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        @media print {
            body { background: white !important; color: black !important; }
            .no-print { display: none !important; }
            #preview-modal { position: relative !important; display: block !important; padding: 0 !important; background: white !important; }
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Dados de Configuração formatados para legibilidade -->
    <script id="config-data" type="application/json">
    [
        {
            "categoria": "Verificação inicial",
            "itens": [
                {
                    "id": "logo",
                    "label": "Logomarca do Senador",
                    "pro": "Identificamos RGB.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Enviar e-mail Logomarca e Atividade Parlamentar.",
                    "critico": false
                }
            ]
        },
        {
            "categoria": "Comprovação no Adobe Acrobat",
            "itens": [
                {
                    "id": "rgb",
                    "label": "Imagens em RGB / Lab / Indexadas",
                    "pro": "Identificamos RGB.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Converter imagens para CMYK (Perfil Fogra39 ou similar).",
                    "critico": false
                },
                {
                    "id": "pant",
                    "label": "Cores Especiais / Pantone ativos",
                    "pro": "Pantones ativos em job CMYK.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Mapear cores para quadricromia no PDF ou fechar novo arquivo.",
                    "critico": false
                },
                {
                    "id": "tac",
                    "label": "Carga de tinta (>300%)",
                    "pro": "Excesso de tinta detectado.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Tratar imagens para reduzir a carga total de tinta (TAC).",
                    "critico": true
                },
                {
                    "id": "res",
                    "label": "Resolução (Abaixo de 300dpi)",
                    "pro": "Imagens abaixo de 300dpi.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Solicitar imagens em alta resolution ou reduzir dimensões.",
                    "critico": false
                },
                {
                    "id": "ovp",
                    "label": "Overprint de Branco",
                    "pro": "Branco em sobreposição.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Remover o atributo de overprint dos objetos brancos.",
                    "critico": true
                },
                {
                    "id": "curv",
                    "label": "Fontes não incorporadas",
                    "pro": "Fontes não embutidas no PDF.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Incorporar fontes no fechamento ou converter em curvas.",
                    "critico": true
                }
            ]
        },
        {
            "categoria": "Verificação manual",
            "itens": [
                {
                    "id": "sng",
                    "label": "Sangria técnica (3mm em todos os lados)",
                    "pro": "Arquivo sem sobra técnica.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Aumentar a arte ou o fundo em 3mm além da linha de corte.",
                    "critico": true
                },
                {
                    "id": "mrg",
                    "label": "Margens de segurança / Respiros",
                    "pro": "Elementos próximos ao corte.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Recuar textos e logos (mín. 4mm) da borda do papel.",
                    "critico": true
                },
                {
                    "id": "fmt",
                    "label": "Formato final da página vs Pedido",
                    "pro": "Tamanho do PDF incorreto.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Ajustar o documento para as medidas finais solicitadas.",
                    "critico": true
                },
                {
                    "id": "k4",
                    "label": "Preto rico em textos/traços finos",
                    "pro": "Textos pequenos em 4 cores.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Alterar a cor do texto para apenas 100% Black (K).",
                    "critico": false
                },
                {
                    "id": "faca",
                    "label": "Faca / Verniz Localizado / Hotstamp",
                    "pro": "Camada técnica incorreta.",
                    "msg": "Lorem ipsum",
                    "action": "Mensagem",
                    "sol": "Definir como Spot Color e aplicar Overprint no atributo.",
                    "critico": true
                },
                {
                    "id": "pags",
                    "label": "Ordem das páginas / Versos em branco",
                    "pro": "Inconsistência na sequência.",
                    "msg": "Lorem ipsum",
                    "action": "Relatório",
                    "sol": "Revisar montagem do PDF e ordem lógica das páginas.",
                    "critico": true
                }
            ]
        }
    ]
    </script>

    <main class="max-w-4xl mx-auto p-4 md:p-8 lg:p-12 no-print">
        
        <!-- Box Principal que engloba tudo -->
        <div class="main-container p-8 md:p-10 space-y-10">
            
            <div id="checklist-container" class="space-y-10">
                <!-- Conteúdo gerado via JS -->
            </div>

            <!-- Botão de Ação -->
            <div class="flex flex-col gap-4 pt-4">
                <button id="btn-gerar" disabled onclick="abrirModalRelatorio()" class="generate-btn w-full bg-white hover:bg-gray-200 text-black font-black py-5 rounded-3xl transition duration-300 flex justify-center items-center gap-3 text-sm uppercase tracking-tighter shadow-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM216,200H40V56H216V200Zm-24-72a8,8,0,0,1-8,8H72a8,8,0,0,1,0-16H184A8,8,0,0,1,192,128Zm0,32a8,8,0,0,1-8,8H72a8,8,0,0,1,0-16H184A8,8,0,0,1,192,160ZM192,96a8,8,0,0,1-8,8H72a8,8,0,0,1,0-16H184A8,8,0,0,1,192,96Z"></path></svg>
                    Gerar Relatório
                </button>
            </div>

        </div>
    </main>

    <!-- Modal de Visualização do Relatório -->
    <div id="preview-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-[2.5rem] overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 bg-gray-50 border-b flex justify-between items-center no-print">
                <span class="text-[10px] font-black uppercase text-gray-400 ml-4">Visualização da Tabela</span>
                <button onclick="fecharModal()" class="p-2 hover:bg-gray-200 rounded-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#000" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
                </button>
            </div>
            <div id="preview-modal-content" class="p-8 md:p-12 overflow-y-auto bg-white text-black leading-relaxed">
                <!-- Conteúdo gerado via JS -->
            </div>
            <div class="p-6 bg-gray-50 border-t grid grid-cols-2 gap-4 no-print">
                <button onclick="copiarTexto()" class="bg-black text-white font-bold py-4 rounded-2xl text-xs uppercase transition hover:bg-gray-800">Copiar</button>
                <button onclick="window.print()" class="border-2 border-black text-black font-bold py-4 rounded-2xl text-xs uppercase transition hover:bg-gray-100">Imprimir</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-12 left-1/2 -translate-x-1/2 bg-emerald-500 text-black font-black text-[10px] px-8 py-3 rounded-full opacity-0 transition-all duration-300 shadow-2xl pointer-events-none uppercase tracking-widest z-[60]">
        Copiado! Pronto para colar no e-mail.
    </div>

    <script>
        let config = [];
        let state = {};
        let totalItens = 0;

        // Função para carregar os dados JSON com tratamento de erro
        function loadConfig() {
            try {
                const configElement = document.getElementById('config-data');
                if (!configElement) throw new Error("Elemento de configuração não encontrado.");
                
                config = JSON.parse(configElement.textContent);
                totalItens = config.reduce((acc, cat) => acc + cat.itens.length, 0);
            } catch (error) {
                console.error("Erro ao carregar configuração:", error);
                document.getElementById('checklist-container').innerHTML = `
                    <div class="bg-red-500/10 border border-red-500 p-6 rounded-2xl text-red-500">
                        <p class="font-bold">Erro de Configuração:</p>
                        <p class="text-xs mt-2">${error.message}</p>
                        <p class="text-xs mt-1 italic">Verifique se o JSON na tag &lt;script id="config-data"&gt; está formatado corretamente (aspas duplas e sem vírgulas sobrando).</p>
                    </div>
                `;
                return false;
            }
            return true;
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = ''; 

            config.forEach(cat => {
                let html = `
                    <div class="space-y-4">
                        <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] ml-2">${cat.categoria}</h3>
                        <div class="inner-group-box">
                            <div class="grid grid-cols-1">
                `;
                cat.itens.forEach((item, index) => {
                    state[item.id] = null;
                    const borderClass = index < cat.itens.length - 1 ? 'border-b border-white/5' : '';
                    html += `
                        <div class="item-row group ${borderClass}" title="Problema: ${item.pro} | Solução: ${item.sol}">
                            <span class="text-sm font-medium text-gray-400 group-hover:text-white cursor-help transition-colors">${item.label}</span>
                            <div class="flex gap-2">
                                <button onclick="setStatus('${item.id}', 'ok')" id="btn-ok-${item.id}" class="status-btn hover:border-emerald-500/50" title="Item Verificado / OK">✓</button>
                                <button onclick="setStatus('${item.id}', 'error')" id="btn-err-${item.id}" class="status-btn hover:border-red-500/50" title="Item com Problema / Erro">✕</button>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div></div>`;
                container.innerHTML += html;
            });
        }

        function setStatus(id, type) {
            const btnOk = document.getElementById(`btn-ok-${id}`);
            const btnErr = document.getElementById(`btn-err-${id}`);

            if (state[id] === type) {
                state[id] = null;
                btnOk.classList.remove('active-ok');
                btnErr.classList.remove('active-error');
            } else {
                state[id] = type;
                if (type === 'ok') {
                    btnOk.classList.add('active-ok');
                    btnErr.classList.remove('active-error');
                } else {
                    btnErr.classList.add('active-error');
                    btnOk.classList.remove('active-ok');
                }
            }
            checkCompletion();
        }

        function checkCompletion() {
            const preenchidos = Object.values(state).filter(v => v !== null).length;
            const btn = document.getElementById('btn-gerar');
            btn.disabled = preenchidos < totalItens;
        }

        function abrirModalRelatorio() {
            gerarRelatorio();
            document.getElementById('preview-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function fecharModal() {
            document.getElementById('preview-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function gerarRelatorio() {
            const preview = document.getElementById('preview-modal-content');

            let errorRows = [];
            config.forEach(cat => {
                cat.itens.forEach(item => {
                    if (state[item.id] === 'error') {
                        errorRows.push({ prob: item.pro, sol: item.sol, critico: item.critico });
                    }
                });
            });

            let htmlContent = `<div style="font-family: Arial, sans-serif; color: #333; max-width: 100%;">`;

            if (errorRows.length === 0) {
                htmlContent += `<div style="padding: 15px; background-color: #e6fffa; border: 1px solid #b2f5ea; border-radius: 12px; color: #234e52; text-align: center;">`;
                htmlContent += `<strong>✅ ARQUIVO APROVADO: Nenhuma inconsistência técnica detectada.</strong>`;
                htmlContent += `</div>`;
            } else {
                htmlContent += `<table style="width: 100%; border-collapse: collapse; font-size: 13px; border: 1px solid #edf2f7;">`;
                htmlContent += `<thead><tr style="background-color: #f7fafc; border-bottom: 2px solid #edf2f7;">`;
                htmlContent += `<th colspan="2" style="padding: 12px; text-align: left; border: 1px solid #edf2f7; width: 50%; font-size: 11px; text-transform: uppercase;">PROBLEMA DETECTADO</th>`;
                htmlContent += `<th style="padding: 12px; text-align: left; border: 1px solid #edf2f7; width: 50%; font-size: 11px; text-transform: uppercase;">COMO RESOLVER</th>`;
                htmlContent += `</tr></thead><tbody>`;
                
                errorRows.forEach(row => {
                    const icon = row.critico 
                        ? `<span style="color: #e53e3e; font-weight: bold;">❌</span>` 
                        : `<span style="color: #d69e2e; font-weight: bold;">⚠️</span>`;
                    
                    htmlContent += `<tr>`;
                    htmlContent += `<td style="padding: 12px; border: 1px solid #edf2f7; width: 35px; text-align: center;">${icon}</td>`;
                    htmlContent += `<td style="padding: 12px; border: 1px solid #edf2f7;">${row.prob}</td>`;
                    htmlContent += `<td style="padding: 12px; border: 1px solid #edf2f7;">${row.sol}</td>`;
                    htmlContent += `</tr>`;
                });
                
                htmlContent += `</tbody></table>`;
            }

            htmlContent += `</div>`;
            preview.innerHTML = htmlContent;
        }

        async function copiarTexto() {
            const reportDiv = document.getElementById('preview-modal-content');
            
            try {
                const blob = new Blob([reportDiv.innerHTML], { type: 'text/html' });
                const data = [new ClipboardItem({ 'text/html': blob, 'text/plain': new Blob([reportDiv.innerText], { type: 'text/plain' }) })];
                await navigator.clipboard.write(data);
            } catch (err) {
                const range = document.createRange();
                range.selectNode(reportDiv);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                window.getSelection().removeAllRanges();
            }
            
            const toast = document.getElementById('toast');
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 2500);
        }

        window.onload = () => {
            if (loadConfig()) {
                renderChecklist();
            }
        };
    </script>
</body>
</html>
