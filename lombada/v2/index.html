<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculo de Lombada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0a;
            --card-dark: #141414;
            --border-subtle: #262626;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #ededed;
            overflow-x: hidden;
        }

        .glass-card {
            background: var(--card-dark);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-subtle);
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .input-dark {
            background: #1a1a1a;
            border: 1px solid #2d2d2d;
            color: #fff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .input-dark:focus {
            border-color: #3b82f6;
            outline: none;
        }

        .canvas-container {
            display: none;
            background: #0f0f0f;
            border-radius: 2rem;
            border: 1px solid var(--border-subtle);
            overflow: hidden;
            width: 100%;
            padding: 1.5rem;
            /* Garante que o box não cresça além do pai no grid */
            max-height: 100%; 
        }

        #drawingArea {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            width: 100%;
            min-height: 0;
            position: relative;
        }

        svg {
            width: 100%;
            height: 100%;
            max-height: 100%;
        }

        /* Linhas técnicas com 1px fixos e sem serrilhado */
        .technical-line {
            vector-effect: non-scaling-stroke;
            shape-rendering: crispEdges;
            stroke-linecap: square;
            stroke-linejoin: miter;
            stroke-width: 1 !important;
        }

        .legenda-item {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.15rem 0.5rem;
            border-radius: 0.5rem;
        }

        .legenda-item:hover {
            background-color: #1a1a1a;
            transform: translateX(4px);
        }
    </style>
</head>
<body class="min-h-screen">

    <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 p-4 md:p-8 lg:p-12 items-start h-full">
        
        <!-- Painel de Controle -->
        <div class="lg:col-span-4 xl:col-span-3 h-auto" id="panelControl">
            <div class="glass-card w-full p-8 rounded-[2rem]">
                <form id="lombadaForm" class="space-y-6" onsubmit="return false;">
                    
                    <div class="space-y-4">
                        <div class="flex flex-col">
                            <label for="tipoPapel" class="text-[10px] font-bold text-gray-500 mb-2 uppercase ml-1">Papel</label>
                            <div class="relative">
                                <select id="tipoPapel" onchange="calcularLombada()" class="w-full input-dark rounded-2xl p-4 text-sm font-medium appearance-none cursor-pointer">
                                </select>
                                <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80a8,8,0,0,1,11.32-11.32L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <label for="encadernacao" class="text-[10px] font-bold text-gray-500 mb-2 uppercase ml-1">Encadernação</label>
                            <div class="relative">
                                <select id="encadernacao" onchange="calcularLombada()" class="w-full input-dark rounded-2xl p-4 text-sm font-medium appearance-none cursor-pointer">
                                    <option value="colada">Colada</option>
                                    <option value="costurada">Costurada</option>
                                </select>
                                <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80a8,8,0,0,1,11.32-11.32L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col">
                        <label for="numPaginas" class="text-[10px] font-bold text-gray-500 mb-2 uppercase ml-1">Número de páginas</label>
                        <input type="number" id="numPaginas" min="1" oninput="calcularLombada()" class="w-full input-dark rounded-2xl p-4 text-sm font-medium focus:border-blue-500 outline-none transition-all">
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[10px] font-bold text-gray-500 mb-2 uppercase ml-1">Formato</label>
                        <div class="input-dark p-6 rounded-2xl space-y-4">
                            <div class="flex items-end gap-2">
                                <div class="flex-1 flex flex-col">
                                    <label for="largura" class="text-[10px] font-bold text-gray-500 mb-2 uppercase text-center block">Largura (mm)</label>
                                    <input type="number" id="largura" oninput="calcularLombada()" class="w-full input-dark rounded-xl p-3 text-center text-sm font-medium text-white">
                                </div>
                                <div class="font-bold text-xs pb-4" style="color: #2d2d2d;">X</div>
                                <div class="flex-1 flex flex-col">
                                    <label for="altura" class="text-[10px] font-bold text-gray-500 mb-2 uppercase text-center block">Altura (mm)</label>
                                    <input type="number" id="altura" oninput="calcularLombada()" class="w-full input-dark rounded-xl p-3 text-center text-sm font-medium text-white">
                                </div>
                            </div>
                            
                            <div class="pt-4 border-t border-white/10">
                                <label for="orelhas" class="text-[10px] font-bold text-gray-500 mb-2 uppercase text-center block">Orelha (mm)</label>
                                <input type="number" id="orelhas" oninput="calcularLombada()" class="w-full input-dark rounded-xl p-3 text-center text-sm font-medium text-white">
                                <div id="infoOrelha" class="text-[9px] text-white text-center mt-2 uppercase font-normal hidden">largura da capa aumentará 2mm</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[10px] font-bold text-gray-500 mb-2 uppercase ml-1">Lombada</label>
                        <div id="containerResultado" class="input-dark p-4 rounded-2xl text-center min-h-[72px] flex items-center justify-center">
                            <p id="resultado" class="text-4xl font-normal text-white"></p>
                        </div>
                    </div>

                    <div id="obs" class="text-center transition-all h-4"></div>
                </form>
            </div>
        </div>

        <!-- Esquema Técnico SVG -->
        <div class="lg:col-span-8 xl:col-span-9 w-full flex flex-col items-stretch h-full self-start">
            <div id="canvasWrapper" class="canvas-container flex flex-col">
                <div id="drawingArea">
                    <!-- O SVG será injetado aqui via JS -->
                </div>
                
                <div id="legendaMedidas" class="mt-2 flex flex-col gap-0 border-t border-white/5 pt-4 text-sm shrink-0">
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('largura')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Largura da capa</span>
                            <span id="leg_largura" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('altura')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Altura da capa</span>
                            <span id="leg_altura" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('lombada')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Lombada</span>
                            <span id="leg_lombada" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div id="leg_orelha_container" class="legenda-item flex items-center" onmouseenter="setHighlight('orelha')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Orelha</span>
                            <span id="leg_orelha" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('total')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Largura total</span>
                            <span id="leg_total_aberto" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('sangriaLargura')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Largura total com sangria</span>
                            <span id="leg_total_sangria_l" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                    <div class="legenda-item flex items-center" onmouseenter="setHighlight('sangriaAltura')" onmouseleave="setHighlight(null)">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Altura com sangria</span>
                            <span id="leg_total_sangria_a" class="text-sm font-medium text-white">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        const papeis = [
            { tipo: "Offset 75g", colada: 0.050, costurada: 0.052 },
            { tipo: "Offset 63g", colada: 0.042, costurada: 0.044 },
            { tipo: "Offset 90g", colada: 0.058, costurada: 0.062 },
            { tipo: "Offset 120g", colada: 0.065, costurada: 0.067 },
            { tipo: "Couchê 90g", colada: 0.044, costurada: 0.046 },
            { tipo: "Couchê 120g", colada: 0.060, costurada: 0.062 },
            { tipo: "Couchê 150g", colada: 0.070, costurada: 0.072 },
            { tipo: "Pólen Soft 70g", colada: 0.048, costurada: 0.050 },
            { tipo: "Pólen Soft 80g", colada: 0.054, costurada: 0.057 },
            { tipo: "Vergê 85g", colada: 0.059, costurada: 0.061 },
        ];

        let lombadaGlobal = 0;
        let highlightedItem = null;
        const SANGRIA = 5;
        const AVANCO_ORELHA = 2;

        const CORES_HOVER = {
            largura: '#ffffff', 
            altura: '#ffffff',
            lombada: '#ffffff',      
            orelha: '#ffffff', 
            total: '#ffffff',   
            sangria: '#ffffff'  
        };

        const COR_ESQUEMA = '#6b7280';

        function setHighlight(item) {
            highlightedItem = item;
            desenharEsquema();
        }

        // Função auxiliar para formatar números com vírgula (padrão PT-BR)
        function formatMM(valor, decimais = 0) {
            return valor.toLocaleString('pt-BR', { 
                minimumFractionDigits: decimais, 
                maximumFractionDigits: decimais 
            }) + " mm";
        }

        function gerarCamposPapel() {
            const selectPapel = document.getElementById("tipoPapel");
            papeis.forEach((papel, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.text = papel.tipo;
                selectPapel.add(option);
            });
            document.getElementById("numPaginas").focus();
        }

        function desenharEsquema() {
            const inputLargura = document.getElementById('largura').value;
            const inputAltura = document.getElementById('altura').value;
            
            const baseLargura = parseFloat(inputLargura);
            const alturaDoc = parseFloat(inputAltura);
            
            const wrapper = document.getElementById('canvasWrapper');
            const drawingArea = document.getElementById('drawingArea');
            const panelControl = document.getElementById('panelControl');

            if (!inputLargura || !inputAltura || baseLargura <= 0 || alturaDoc <= 0) {
                wrapper.style.display = 'none';
                return;
            }

            wrapper.style.display = 'flex';
            
            if (window.innerWidth >= 1024) {
                const panelHeight = panelControl.offsetHeight;
                wrapper.style.height = panelHeight + 'px';
                wrapper.style.maxHeight = panelHeight + 'px';
            } else {
                wrapper.style.height = '500px';
                wrapper.style.maxHeight = 'none';
            }

            const orelhaInput = document.getElementById('orelhas').value;
            const orelhaDoc = (orelhaInput === "" || parseFloat(orelhaInput) <= 0) ? 0 : parseFloat(orelhaInput);
            const espessura = lombadaGlobal || 0;
            const larguraCapa = orelhaDoc > 0 ? baseLargura + AVANCO_ORELHA : baseLargura;

            const larguraTotalAberta = (orelhaDoc * 2) + (larguraCapa * 2) + espessura;
            const larguraSangria = larguraTotalAberta + (SANGRIA * 2);
            const alturaSangria = alturaDoc + (SANGRIA * 2);

            // Atualização da legenda com vírgula
            document.getElementById('leg_largura').innerText = formatMM(larguraCapa);
            document.getElementById('leg_altura').innerText = formatMM(alturaDoc);
            document.getElementById('leg_lombada').innerText = formatMM(espessura, 1);
            document.getElementById('leg_orelha').innerText = formatMM(orelhaDoc);
            document.getElementById('leg_total_aberto').innerText = formatMM(larguraTotalAberta, 1);
            document.getElementById('leg_total_sangria_l').innerText = formatMM(larguraSangria, 1);
            document.getElementById('leg_total_sangria_a').innerText = formatMM(alturaSangria, 1);
            document.getElementById('leg_orelha_container').style.display = orelhaDoc > 0 ? 'flex' : 'none';

            const margin = 50;
            const viewW = Math.floor(larguraSangria + (margin * 2));
            const viewH = Math.floor(alturaSangria + (margin * 2));

            const x0 = Math.floor(margin);
            const y0 = Math.floor(margin);
            const xPapel = Math.floor(x0 + SANGRIA);
            const yPapel = Math.floor(y0 + SANGRIA);

            const xO1 = xPapel;
            const xC1 = Math.floor(xO1 + orelhaDoc);
            const xL = Math.floor(xC1 + larguraCapa);
            const xC2 = Math.floor(xL + espessura);
            const xO2 = Math.floor(xC2 + larguraCapa);

            let svgContent = `
                <svg viewBox="0 0 ${viewW} ${viewH}" preserveAspectRatio="xMidYMid meet">
                    <rect x="${x0}" y="${y0}" width="${Math.floor(larguraSangria)}" height="${Math.floor(alturaSangria)}" 
                        fill="none" class="technical-line" style="stroke: ${COR_ESQUEMA};" />
                    
                    <rect x="${xPapel}" y="${yPapel}" width="${Math.floor(larguraTotalAberta)}" height="${Math.floor(alturaDoc)}" fill="#111111" />

                    <g fill="none" class="technical-line" style="stroke: ${COR_ESQUEMA};">
                        <rect x="${xC1}" y="${yPapel}" width="${Math.floor(larguraCapa)}" height="${Math.floor(alturaDoc)}" />
                        <rect x="${xL}" y="${yPapel}" width="${Math.floor(espessura)}" height="${Math.floor(alturaDoc)}" />
                        <rect x="${xC2}" y="${yPapel}" width="${Math.floor(larguraCapa)}" height="${Math.floor(alturaDoc)}" />
                        
                        ${orelhaDoc > 0 ? `
                            <rect x="${xO1}" y="${yPapel}" width="${Math.floor(orelhaDoc)}" height="${Math.floor(alturaDoc)}" />
                            <rect x="${xO2}" y="${yPapel}" width="${Math.floor(orelhaDoc)}" height="${Math.floor(alturaDoc)}" />
                        ` : ''}
                    </g>

                    <g class="technical-line" style="stroke: ${COR_ESQUEMA};">
                        ${orelhaDoc > 0 ? `<line x1="${xC1}" y1="${yPapel}" x2="${xC1}" y2="${Math.floor(yPapel + alturaDoc)}" />` : ''}
                        <line x1="${xL}" y1="${yPapel}" x2="${xL}" y2="${Math.floor(yPapel + alturaDoc)}" />
                        <line x1="${xC2}" y1="${yPapel}" x2="${xC2}" y2="${Math.floor(yPapel + alturaDoc)}" />
                        ${orelhaDoc > 0 ? `<line x1="${xO2}" y1="${yPapel}" x2="${xO2}" y2="${Math.floor(yPapel + alturaDoc)}" />` : ''}
                    </g>

                    ${getHighlightsSVG(xC1, xL, xC2, xO2, xO1, x0, y0, yPapel, alturaDoc, espessura, orelhaDoc, larguraCapa, larguraTotalAberta, larguraSangria, alturaSangria)}
                </svg>
            `;

            drawingArea.innerHTML = svgContent;
        }

        function getHighlightsSVG(xC1, xL, xC2, xO2, xO1, x0, y0, yP, hD, esp, orelha, lCapa, lTotal, lSangria, hSangria) {
            if (!highlightedItem) return '';
            
            switch(highlightedItem) {
                case 'largura':
                    return `
                        <line x1="${xC1}" y1="${yP}" x2="${xL}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.largura};" />
                        <line x1="${xC2}" y1="${yP}" x2="${xO2}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.largura};" />
                    `;
                case 'altura':
                    return `
                        <line x1="${xO2 + orelha}" y1="${yP}" x2="${xO2 + orelha}" y2="${Math.floor(yP + hD)}" class="technical-line" style="stroke: ${CORES_HOVER.altura};" />
                    `;
                case 'lombada':
                    return `
                        <line x1="${xL}" y1="${yP}" x2="${xC2}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.lombada};" />
                    `;
                case 'orelha':
                    if (orelha <= 0) return '';
                    return `
                        <line x1="${xO1}" y1="${yP}" x2="${xC1}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.orelha};" />
                        <line x1="${xO2}" y1="${yP}" x2="${Math.floor(xO2 + orelha)}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.orelha};" />
                    `;
                case 'total':
                    return `
                        <line x1="${xO1}" y1="${yP}" x2="${Math.floor(xO1 + lTotal)}" y2="${yP}" class="technical-line" style="stroke: ${CORES_HOVER.total};" />
                    `;
                case 'sangriaLargura':
                    return `
                        <line x1="${x0}" y1="${y0}" x2="${Math.floor(x0 + lSangria)}" y2="${y0}" class="technical-line" style="stroke: ${CORES_HOVER.sangria};" />
                    `;
                case 'sangriaAltura':
                    return `
                        <line x1="${x0}" y1="${y0}" x2="${x0}" y2="${Math.floor(y0 + hSangria)}" class="technical-line" style="stroke: ${CORES_HOVER.sangria};" />
                    `;
                default:
                    return '';
            }
        }

        function calcularLombada() {
            const papelIndex = document.getElementById("tipoPapel").value;
            const encadernacao = document.getElementById("encadernacao").value;
            const paginasInput = document.getElementById("numPaginas").value;
            const orelhas = parseFloat(document.getElementById("orelhas").value) || 0;
            
            const resultadoDisplay = document.getElementById("resultado");
            const obsDisplay = document.getElementById("obs");
            document.getElementById("infoOrelha").classList.toggle('hidden', orelhas <= 0);

            if (!paginasInput || paginasInput <= 0) {
                lombadaGlobal = 0;
                resultadoDisplay.innerHTML = "";
                obsDisplay.innerHTML = "";
                desenharEsquema();
                return;
            }

            const papel = papeis[papelIndex];
            const fator = encadernacao === "colada" ? papel.colada : papel.costurada;
            lombadaGlobal = parseFloat(paginasInput) * fator;

            resultadoDisplay.innerHTML = `${lombadaGlobal.toLocaleString('pt-BR', { maximumFractionDigits: 1 })}<span class="text-xl ml-1 text-white">mm</span>`;
            obsDisplay.innerHTML = (lombadaGlobal < 3) ? `<p class="text-[9px] text-white font-normal uppercase animate-pulse">Lombada mínima sugerida: 3 mm</p>` : "";

            desenharEsquema();
        }

        window.addEventListener('resize', desenharEsquema);
        window.onload = gerarCamposPapel;
    </script>
</body>
</html>
